const MAX_SUGGESTIONS=50,MAX_SECTION_RESULTS=3,MAX_SUBSTRING_LIMIT=100,ANIMATION_TIME=200,FETCH_RESULTS_DELAY=250,CLEAR_RESULTS_DELAY=300,RTD_SEARCH_PARAMETER="rtd_search",debounce=(b,c)=>{let d,a=function(){let a=this,e=arguments;clearTimeout(d),d=setTimeout(()=>b.apply(a,e),c)};return a.cancel=()=>{clearTimeout(d),d=null},a},buildSection=function(g,h,i,c){let d=createDomNode("span",{class:"search__result__subheading"});d.innerHTML=h;let a=createDomNode("div",{class:"outer_div_page_results",id:g});a.appendChild(d);for(var b=0;b<c.length;b+=1){let e=createDomNode("p",{class:"search__result__content"});e.innerHTML=c[b],a.appendChild(e)}let f=createDomNode("a",{href:i});return f.appendChild(a),f},updateUrl=()=>{let a=new URL(window.location.href),b=getSearchTerm();b.length>0?a.searchParams.set(RTD_SEARCH_PARAMETER,b):a.searchParams.delete(RTD_SEARCH_PARAMETER),window.history.pushState({},null,a.toString())},updateSearchBar=()=>{getInputField().value=getSearchTerm()},isModalVisible=()=>{let a=document.querySelector(".search__outer__wrapper");return null!==a&&null!==a.style&&null!==a.style.display&&"block"===a.style.display},createDomNode=(d,a)=>{let b=document.createElement(d);if(null!==a)for(let c in a)b.setAttribute(c,a[c]);return b},_is_string=a=>"string"==typeof a&&a.length>0,get_section_html=(a,g,h)=>{let e=a.title,b=a.highlights;b.title.length&&(e=b.title[0]);let d=[a.content.substring(0,MAX_SUBSTRING_LIMIT)+" ..."];if(b.content.length){let f=b.content;d=[];for(let c=0;c<f.length&&c<3;++c)d.push("... "+f[c]+" ...")}let i=`${g}#${a.id}`;return buildSection("hit__"+h,e,i,d)},get_domain_html=(a,f,g)=>{let h=`${f}#${a.id}`,i=a.role,c=a.name,d=a.content.substr(0,MAX_SUBSTRING_LIMIT)+" ...",b=a.highlights;b.name.length&&(c=b.name[0]),b.content.length&&(d=b.content[0]);let j="hit__"+g,e=createDomNode("div",{class:"search__domain_role_name"});return e.innerText=`[${i}]`,buildSection(j,c+=e.outerHTML,h,[d])},generateSingleResult=(a,q,g,h)=>{for(let b=0;b<a.blocks.length;++b){let i=a.blocks[b];if("domain"===i.type){let l=i.role.substr(3);void 0!==h[l]&&!h[l]&&(a.blocks.splice(b,1),--b)}else"section"===i.type&& !h.docs&&(a.blocks.splice(b,1),--b)}if(0===a.blocks.length)return;let j=a.path,m=a.title,n=a.highlights;n.title.length&&(m=n.title[0]);let c=createDomNode("h2",{class:"search__result__title"});if(c.innerHTML=m,q!==a.project){let o=createDomNode("small",{class:"rtd_ui_search_subtitle"});o.innerText=`(from project ${a.project})`,c.appendChild(o)}c.appendChild(createDomNode("br"));let p=createDomNode("a",{href:j});p.appendChild(c);let d=createDomNode("div");d.appendChild(p);let r=createDomNode("br",{class:"br-for-hits"});for(let k=0;k<a.blocks.length;++k){let e=a.blocks[k],f=null;g+=1,"section"===e.type?f=get_section_html(e,j,g):"domain"===e.type&&(f=get_domain_html(e,j,g)),null!==f&&(d.appendChild(f),d.appendChild(r))}return d},generateSuggestionsList=(c,h)=>{let e=createDomNode("div",{class:"search__result__box"}),i=Math.min(50,c.results.length),d=0,a={class:document.getElementById("drp-classes").checked,method:document.getElementById("drp-methods").checked,parameter:document.getElementById("drp-params").checked,attribute:document.getElementById("drp-attrs").checked,docs:document.getElementById("drp-docs").checked};a.property=a.attribute,a.exception=a.class,a.data=a.attribute,a.module=a.docs,a.function=a.method;for(let b=0;b<i;++b){let f=generateSingleResult(c.results[b],h,d,a);if(void 0!==f){let g=createDomNode("div",{class:"search__result__single"});g.appendChild(f),e.appendChild(g),d+=c.results[b].blocks.length}}return 0===d?null:e},removeAllActive=()=>{let c=document.querySelectorAll(".outer_div_page_results.active"),b=Object.keys(c).map(a=>c[a]);for(let a=1;a<=b.length;++a)b[a-1].classList.remove("active")},addActive=b=>{let a=document.querySelector("#hit__"+b);null!==a&&(a.classList.add("active"),a.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))},selectNextResult=h=>{let b=document.querySelectorAll(".outer_div_page_results"),c=document.querySelector(".outer_div_page_results.active"),a=1,d=1;if(b.length>0){let e=b[b.length-1];if(null!==e.id){let f=e.id.match(/\d+/);null!==f&&(d=Number(f[0]))}}if(null!==c&&null!==c.id){let g=c.id.match(/\d+/);null!==g&&(a=Number(g[0]),a+=h?1:-1)}a<=0?a=d:a>d&&(a=1),removeAllActive(),addActive(a)},getInputField=()=>{let a;try{if(void 0===(a=document.querySelector("[role='search'] input"))||null===a)throw"'[role='search'] input' not found"}catch(b){a=document.querySelector("input[name='q']")}return a},getSearchTerm=()=>{let a=document.querySelector(".search__outer__input");return null!==a?a.value.startsWith("tg.")?"telegram."+a.value.substr(3):/^[A-Z]/.test(a.value)?"telegram."+a.value:a.value||"":""},removeResults=()=>{let b=document.querySelectorAll(".search__result__box");for(let a=0;a<b.length;++a)b[a].parentElement.removeChild(b[a])},getErrorDiv=b=>{let a=createDomNode("div",{class:"search__result__box search__error__box"});return a.innerHTML=b,a},fetchAndGenerateResults=(d,e,f)=>{let b=document.querySelector(".search__outer");removeResults();let a=createDomNode("div",{class:"search__result__box"});a.innerHTML="<strong>Searching...</strong>",b.appendChild(a);let c=()=>{updateUrl(),updateSearchBar();let a=d+"?"+new URLSearchParams(e).toString();fetch(a,{method:"GET"}).then(a=>{if(!a.ok)throw new Error;return a.json()}).then(a=>{if(a.results.length>0){let c=generateSuggestionsList(a,f);if(removeResults(),c)b.appendChild(c),b.addEventListener("mouseenter",a=>{removeAllActive()});else{let d=getErrorDiv("No results found");b.appendChild(d)}}else{removeResults();let e=getErrorDiv("No results found");b.appendChild(e)}}).catch(a=>{console.log(a),removeResults();let c=getErrorDiv("There was an error. Please try again.");b.appendChild(c)})};return debounce(c,250)},generateAndReturnInitialHtml=()=>{let b='<div class="search__outer">             <div class="search__outer__input__wrapper">                 <input class="search__outer__input" spellcheck="false" placeholder="Search">                 <span class="bar"></span>                 <div class="dropdown" tabindex="0">                     <button class="dropbtn">Type                        <i class="arrow down"></i>                    </button>                     <ul class="dropdown-content">                         <li><a href="#"><input type="checkbox" id="drp-classes" checked/><label for="drp-classes">&nbsp;&nbsp;Classes</label></a></li>                         <li><a href="#"><input type="checkbox" id="drp-methods" checked/><label for="drp-methods">&nbsp;&nbsp;Methods</label></a></li>                         <li><a href="#"><input type="checkbox" id="drp-attrs" checked/><label for="drp-attrs">&nbsp;&nbsp;Attributes</label></a></li>                         <li><a href="#"><input type="checkbox" id="drp-params" checked/><label for="drp-params">&nbsp;&nbsp;Parameters</label></a></li>                         <li><a href="#"><input type="checkbox" id="drp-docs" checked/><label for="drp-docs">&nbsp;&nbsp;Docstring</label></a></li>                     </ul>                 </div>                 <div class="search__cross" title="Close">                     <!--?xml version="1.0" encoding="UTF-8"?-->                     <svg class="search__cross__img" width="15px" height="15px" enable-background="new 0 0 96 96" version="1.1" viewBox="0 0 96 96" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">                         <polygon fill="#AAAAAB" points="96,14 82,0 48,34 14,0 0,14 34,48 0,82 14,96 48,62 82,96 96,82 62,48 "></polygon>                     </svg>             </div>             </div>         </div>         <div class="rtd__search__credits">             Search by <a href="https://readthedocs.org/">Read the Docs</a> & <a href="https://github.com/harshil21/furo-sphinx-search">furo-sphinx-search</a>         </div>',a=createDomNode("div",{class:"search__outer__wrapper search__backdrop"});return a.innerHTML=b,a},showSearchModal=a=>{removeResults(),$(".search__outer__wrapper").fadeIn(200,()=>{let c=getInputField();c.blur();let b=document.querySelector(".search__outer__input");null!==b&&(void 0!==a&&_is_string(a)?(b.value=a,c.value=a):b.value=c.value,b.focus())})},removeSearchModal=()=>{removeResults(),updateSearchBar();let a=document.querySelector(".search__outer__input");null!==a&&(a.value="",a.blur()),updateUrl(),$(".search__outer__wrapper").fadeOut(200)};window.addEventListener("DOMContentLoaded",()=>{if(window.hasOwnProperty("READTHEDOCS_DATA")){let j=READTHEDOCS_DATA.project,k=READTHEDOCS_DATA.version,l=READTHEDOCS_DATA.proxied_api_host||"/_",d=generateAndReturnInitialHtml();document.body.appendChild(d);let e=document.querySelector(".search__outer__wrapper"),a=document.querySelector(".search__outer__input"),f=document.querySelector(".search__cross"),m=null,g=getInputField();g.addEventListener("focus",a=>{showSearchModal()});let n=()=>{let a=getSearchTerm();if(a.length>0){null!==m&&m.cancel();let b=l+"/api/v2/search/",c={q:a,project:j,version:k};(m=fetchAndGenerateResults(b,c,j))()}else{let d=()=>{removeResults(),updateUrl()};debounce(d,300)(),updateUrl()}};a.addEventListener("input",a=>{n()}),a.addEventListener("keydown",a=>{if(40===a.keyCode&&(a.preventDefault(),selectNextResult(!0)),38===a.keyCode&&(a.preventDefault(),selectNextResult(!1)),13===a.keyCode){a.preventDefault();let b=document.querySelector(".outer_div_page_results.active");if(null!==b){let c=b.parentElement.href;window.location.href=c}else{let d=getInputField(),e=d.parentElement;g.value=getSearchTerm(),e.submit()}}}),e.addEventListener("click",a=>{a.target.parentNode===document.body&&removeSearchModal()}),f.addEventListener("click",a=>{removeSearchModal()}),document.addEventListener("keydown",a=>{27===a.keyCode&&removeSearchModal()}),document.addEventListener("keydown",a=>{191!==a.keyCode||isModalVisible()||(a.preventDefault(),showSearchModal())});let h=document.querySelector(".dropbtn");h.addEventListener("click",c=>{let a=window.getComputedStyle(document.querySelector(".dropdown-content",":focus-within")),b=parseFloat(a.maxHeight.substring(0,a.maxHeight.length-2));document.activeElement===h&&300===b&&h.blur()}),document.addEventListener("change",a=>{n()});let i=new URLSearchParams(document.location.search),b=i.get(RTD_SEARCH_PARAMETER);if(null!==b){showSearchModal(b),a.value=b;let c=document.createEvent("Event");c.initEvent("input",!0,!0),a.dispatchEvent(c)}}else console.log("[INFO] Docs are not being served on Read the Docs, readthedocs-sphinx-search will not work.")})